<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - ClaudeCodeChanges</title>
    <link rel="stylesheet" href="{{ base_url }}/static/style.css">
    <link rel="alternate" type="application/rss+xml" title="ClaudeCodeChanges Changelog" href="{{ base_url }}/feed.xml">
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            const stored = localStorage.getItem('theme');
            if (stored) {
                document.documentElement.setAttribute('data-theme', stored);
            }
        })();
    </script>
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title"><a href="{{ base_url }}/">ClaudeCodeChanges</a></h1>
            <div class="header-actions">
                <button class="theme-toggle" id="theme-toggle" title="Toggle theme" aria-label="Toggle theme">
                    <!-- Auto icon (circle with half) -->
                    <svg class="icon-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="9"></circle>
                        <path d="M12 3v18"></path>
                        <path d="M12 3a9 9 0 0 1 0 18" fill="currentColor"></path>
                    </svg>
                    <!-- Sun icon -->
                    <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <!-- Moon icon -->
                    <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <div class="calendar-dropdown">
                    <button class="calendar-toggle" title="Calendar" aria-label="Toggle calendar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </button>
                    <div class="calendar-popup" id="calendar-popup">
                        {% block calendar %}{% endblock %}
                    </div>
                </div>
                <button class="rss-btn" id="rss-copy" title="Copy RSS Feed URL" data-url="{{ base_url }}/feed.xml">
                    <svg class="rss-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 11a9 9 0 0 1 9 9"></path>
                        <path d="M4 4a16 16 0 0 1 16 16"></path>
                        <circle cx="5" cy="19" r="1"></circle>
                    </svg>
                    <svg class="rss-check" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="layout">
        <main class="content">
            <nav class="changelog-nav">
                {% block nav %}{% endblock %}
            </nav>
            <article class="changelog-content">
                {% block content %}{% endblock %}
            </article>
        </main>
    </div>

    <footer class="site-footer">
        <p>Tracking changes to <a href="https://code.claude.com">Claude Code</a> and <a href="https://docs.anthropic.com">Claude API</a> documentation.</p>
    </footer>

    <script>
        // Theme toggle - use onclick for reliability
        document.getElementById('theme-toggle').onclick = function() {
            const root = document.documentElement;
            const current = root.getAttribute('data-theme');
            let next;
            if (!current) {
                next = 'light';
            } else if (current === 'light') {
                next = 'dark';
            } else {
                next = null;
            }
            if (next) {
                root.setAttribute('data-theme', next);
                localStorage.setItem('theme', next);
            } else {
                root.removeAttribute('data-theme');
                localStorage.removeItem('theme');
            }
        };

        // Calendar toggle
        document.querySelector('.calendar-toggle').onclick = function(e) {
            e.stopPropagation();
            document.getElementById('calendar-popup').classList.toggle('active');
        };

        document.addEventListener('click', function(e) {
            const popup = document.getElementById('calendar-popup');
            const toggle = document.querySelector('.calendar-toggle');
            if (!popup.contains(e.target) && !toggle.contains(e.target)) {
                popup.classList.remove('active');
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('calendar-popup').classList.remove('active');
            }
        });

        // Open all changelog links in new window
        document.querySelectorAll('.changelog-content a').forEach(function(link) {
            link.setAttribute('target', '_blank');
            link.setAttribute('rel', 'noopener');
        });

        // RSS copy to clipboard
        document.getElementById('rss-copy').onclick = function() {
            const btn = this;
            const url = window.location.origin + btn.getAttribute('data-url');
            navigator.clipboard.writeText(url).then(function() {
                btn.classList.add('copied');
                setTimeout(function() {
                    btn.classList.remove('copied');
                }, 2000);
            });
        };
    </script>
</body>
</html>
