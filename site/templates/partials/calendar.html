<div class="calendar-section">
    <div class="calendar-header">
        <button class="calendar-nav-btn" id="cal-prev" aria-label="Previous month">&larr;</button>
        <h3 id="calendar-title"></h3>
        <button class="calendar-nav-btn" id="cal-next" aria-label="Next month">&rarr;</button>
    </div>
    <div class="calendar-legend">
        <span class="legend-item"><span class="legend-dot version"></span> New version</span>
        <span class="legend-item"><span class="legend-dot docs"></span> Docs only</span>
    </div>

    {% for month in calendar.months %}
    <table class="calendar" data-month-index="{{ loop.index0 }}" {% if loop.index0 != calendar.current_index %}style="display: none;"{% endif %}>
        <thead>
            <tr>
                <th>S</th>
                <th>M</th>
                <th>T</th>
                <th>W</th>
                <th>T</th>
                <th>F</th>
                <th>S</th>
            </tr>
        </thead>
        <tbody>
            {% for week in month.weeks %}
            <tr>
                {% for day in week %}
                <td class="{% if day.has_changelog %}has-entry{% endif %}{% if day.has_version %} has-version{% endif %}{% if day.is_current %} current{% endif %}">
                    {% if day.has_changelog %}
                        <a href="{{ base_url }}{{ day.url }}">{{ day.number }}</a>
                    {% elif day.number %}
                        <span>{{ day.number }}</span>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
</div>

<script>
(function() {
    const months = {{ calendar.months | tojson }};
    let currentIndex = {{ calendar.current_index }};

    const title = document.getElementById('calendar-title');
    const prevBtn = document.getElementById('cal-prev');
    const nextBtn = document.getElementById('cal-next');
    const tables = document.querySelectorAll('.calendar[data-month-index]');

    function updateDisplay() {
        const month = months[currentIndex];
        title.textContent = month.name + ' ' + month.year;

        tables.forEach((table, i) => {
            table.style.display = i === currentIndex ? '' : 'none';
        });

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === months.length - 1;
        prevBtn.style.visibility = currentIndex === 0 ? 'hidden' : 'visible';
        nextBtn.style.visibility = currentIndex === months.length - 1 ? 'hidden' : 'visible';
    }

    prevBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (currentIndex > 0) {
            currentIndex--;
            updateDisplay();
        }
    });

    nextBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (currentIndex < months.length - 1) {
            currentIndex++;
            updateDisplay();
        }
    });

    updateDisplay();
})();
</script>
